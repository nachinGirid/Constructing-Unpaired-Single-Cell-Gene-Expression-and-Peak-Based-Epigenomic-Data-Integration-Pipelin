# Run_Clustering

This directory contains scripts for **Clustering and label transfer**
applied to joint RNA–ATAC embeddings generated by different integration methods.
All scripts operate on **precomputed embeddings**  

The clustering approaches implemented here are:

1. **KNN-based label transfer**   
2. **Leiden clustering**
3. **MOSCOT optimal-transport–based label transfer**
4. **FigR Anchor–based label transfer**
- (**Seurat Anchor–based label transferring part was included in Seurat dimension reduction script**)

Each script is provided as a **minimal reference implementation** with a fixed
example data and. method setting and can be adapted by editing parameters at the top of the file.

---

## 1. KNN-based label transfer and Leiden clustering

**Script:** `KNN_and_Leiden.py`

This script run code for two simple clusterings approaches:

- **KNN label transfer:**  
  RNA cell-type labels are transferred to ATAC cells using a K-nearest-neighbor
  classifier trained on RNA embeddings.
- **Leiden clustering:**  
  RNA and ATAC embeddings are concatenated and clustered jointly by Leiden community detection.

### Inputs
- `rna_em.csv`, `atac_em.csv` (joint embeddings)
- `seurat_RNA_label.txt`
- `barcodes.tsv`

### Outputs
- `atac_label_knn.txt`
- `rna_label_leiden.txt`
- `atac_label_leiden.txt`

---

## 2. MOSCOT optimal-transport-based label transfer

**Script:** `MOSCOT_optimal_transport.py`

This script performs **cross-modality label transfer using optimal transport**
implemented in MOSCOT.

RNA and ATAC embeddings are treated as two distributions in a shared embedding
space, and an optimal transport plan is computed between them. RNA labels are
then transferred to ATAC cells using a top-k majority vote based on transport mass.

### Inputs
- `rna_em.csv`, `atac_em.csv`
- `seurat_RNA_label.txt` (or `.csv`)
- `barcodes.tsv`
- `rna_fil_rowsum0.h5ad`
- `atac_fil_rowsum0.h5ad`

### Output
- `atac_label_moscot.txt`

---

## 3. FigR-based label transfer

**Directory:** `FigR/`

FigR performs label transfer by **geodesic pairing** between RNA and ATAC cells
in the embedding space, followed by neighborhood-based label propagation.

### Core scripts
- `cellPairing.R` – geodesic cell pairing
- `FigR.R` – main FigR routines
- `FigR_label_tranfer.r` – Main code for Figr label transfer
- `Function_anchor_transfer_label.r` – label transfer helpers function
- `utils.R` – utility functions

_MultiMAP-specific FigR code_

_The subfolder: for_multimap_embedding holds FigR code modified for MultiMAP outputs. Because MultiMAP already produces a robust joint layout, these variants skip recomputing UMAP on MultiMAP embedding._

### Output
- `atac_labels_figR.txt`

---

## Notes

- All scripts assume embeddings have already been generated and saved in a
  standardized folder structure.
- Parameters are fixed or automatically selected to ensure **fair and consistent
  evaluation across methods and datasets**.
- These scripts are intended as **benchmark evaluation code**, not as
  general-purpose pipelines.

